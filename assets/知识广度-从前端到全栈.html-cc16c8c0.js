import{_ as n,o as s,c as a,a as t}from"./app-1abbb6ea.js";const p="/Lin-Note-v2/assets/image-20230115122145258-1675344127793-55.90c15fbc-a4ffd979.png",o="/Lin-Note-v2/assets/image-20230115174821187-1675344132576-58.e5ddbd60-7055bad0.png",e="/Lin-Note-v2/assets/image-20230115180311760-1675344135308-61.20307bcf-129cd562.png",c="/Lin-Note-v2/assets/image-20230115200304620-1675344138099-64.4e4b5509-4b787b0e.png",l="/Lin-Note-v2/assets/image-20230115205133652-1675344142439-67.2a2c51e4-a5c2c9a5.png",i="/Lin-Note-v2/assets/image-20230116164846163-1675344144879-70.aa9e11f6-1d731e6f.png",u="/Lin-Note-v2/assets/image-20230116223029019-1675344150157-73.39969d4e-55e69191.png",k="/Lin-Note-v2/assets/image-20230117004631255-1675344155516-76.a43146c6-98ce5ddc.png",r={},d=t('<h1 id="知识广度-从前端到全栈" tabindex="-1"><a class="header-anchor" href="#知识广度-从前端到全栈" aria-hidden="true">#</a> 知识广度-从前端到全栈</h1><h2 id="_1-移动端-h5-click-有-300ms-延迟-如何解决" tabindex="-1"><a class="header-anchor" href="#_1-移动端-h5-click-有-300ms-延迟-如何解决" aria-hidden="true">#</a> 1. 移动端 H5 click 有 300ms 延迟，如何解决？</h2><p>背景：double tap to zoom</p><p>过去的解决方案：FastClick npm 插件</p><p>现在的解决方案；<code>&lt;meta&gt;</code> 中设置 <code>width=device-width</code></p><h2 id="_2-网络请求中-token-和-cookie-有什么区别" tabindex="-1"><a class="header-anchor" href="#_2-网络请求中-token-和-cookie-有什么区别" aria-hidden="true">#</a> 2. 网络请求中，token 和 cookie 有什么区别？</h2><p>cookie</p><ul><li>HTTP 无状态，每次请求都要带 cookie，以帮助识别身份</li><li>服务端也可以向客户端 set-cookie，cookie 大小限制 4kb</li><li>默认有跨域限制：不可跨域共享 cookie、不可跨域传递 cookie</li><li>前端可以通过设置 withCredentials 来运行跨域传递</li></ul><p>cookie 本地存储</p><ul><li>HTML5 之前 cookie 常被用于本地存储</li><li>HTML5 之后 推荐使用 localStorage 和 sessionStorage ( localStorage 也是跨域不共享的 )</li></ul><p>现代浏览器开始禁用第三方 cookie</p><ul><li>和跨域限制不同。这里是：禁止网页引入的第三方 JS 设置 cookie</li><li>打击第三方广告，保护用户隐私</li><li>新增属性 SameSite：Strict / Lax / None; 值可自己选择</li></ul><p>cookie 和 session</p><ul><li>cookie 用于登录验证，存储用户表示 (如 userId )</li><li>session 在服务端，存储用户详细信息，和 cookie 信息一一对应</li><li>cookie + session 是常见登录验证解决方案</li></ul><p><img src="'+p+'" alt="image-20230115122145258"></p><p>能不能把 session 去掉，将用户所有信息 (用户姓名、手机号等) 都塞给 cookie?</p><ul><li>安全问题（泄漏用户信息）</li><li>体积问题（cookie 只有 4kb）</li></ul><p>token vs cookie</p><ul><li>cookie 是 HTTP 规范，而 token 是自定义传递</li><li>cookie 会默认被浏览器存储，而 token 需自己存储</li><li>token 默认没有跨域限制</li></ul><p>JWT (JSON Web Token)</p><ul><li>前端发起登录，后端验证成功之后，返回一个加密的 token</li><li>前端自行存储这个 token (其实包含了用户信息，加密了)</li><li>以后访问服务端接口，都带着这个 token, 作为用户信息</li></ul><p>token 和 cookie 的区别？</p><ul><li>cookie：HTTP 标准；跨域限制；配合 session 使用；</li><li>token：无标准；无跨域限制；用于 JWT</li></ul><blockquote><p>扩展</p><ul><li>因为 cookie 存储大小有限制，所以 信息集中存储在 session 中</li></ul></blockquote><h2 id="_3-session-和-jwt-哪个更好" tabindex="-1"><a class="header-anchor" href="#_3-session-和-jwt-哪个更好" aria-hidden="true">#</a> 3. session 和 JWT 哪个更好？</h2><p>session 优点</p><ul><li>原理简单，易于学习</li><li>用户信息存储在服务端，可快速封禁某个用户</li></ul><p>session 缺点</p><ul><li>占用服务端内存，硬件成功高</li><li>多进程，多服务器时，不好同步 --- 需使用第三方缓存，如 redis</li><li>默认有跨域限制</li></ul><p>JWT 优点</p><ul><li>不占用服务端内存</li><li>多进程、多服务 不受影响</li></ul><p>JWT 缺点</p><ul><li>用户信息存储在客户端，无法快速封禁某个用户（可以通过建立黑名单，来封禁用户，代价是消耗内存）</li><li>万一服务端密钥被泄漏，则用户信息全部丢失</li><li>token 体积一般大于 cookie, 会增加请求的数据量</li></ul><p>对比</p><ul><li>如有严格管理用户信息的需求 (保密、快速封禁) 推荐 Session</li><li>如没有特殊要求，则使用 JWT (如创业初期的网站)</li></ul><h2 id="_4-如何实现-sso-单点登录" tabindex="-1"><a class="header-anchor" href="#_4-如何实现-sso-单点登录" aria-hidden="true">#</a> 4. 如何实现 SSO 单点登录</h2><p>基于 cookie</p><ul><li>cookie 默认不可跨域共享，但有些情况下可设置为共享</li><li>主域名相同，如 <code>www.baidu.com</code> <code>image.baidu.com</code> (www、image 为二级域名，baidu.com 为主域名)</li><li>设置 cookie domain 为主域名，即可共享 cookie</li></ul><p><img src="'+o+'" alt="image-20230115174821187"></p><p>SSO</p><ul><li>主域名完全不同，则 cookie 无法共享</li><li>可使用 SSO 技术方案</li></ul><p>第三方登录（ OAuth 2.0 ）</p><ul><li>如 微信登录</li></ul><p><img src="'+e+'" alt="image-20230115180311760"></p><blockquote><p>扩展</p><ul><li>主域名相同，则可共享 cookie</li><li>主域名不同，则需使用 SSO (单点登录)</li></ul></blockquote><h2 id="_5-http-协议-和-udp-协议有什么区别" tabindex="-1"><a class="header-anchor" href="#_5-http-协议-和-udp-协议有什么区别" aria-hidden="true">#</a> 5. HTTP 协议 和 UDP 协议有什么区别？</h2><p>网络协议</p><ul><li>HTTP 协议在应用层</li><li>TCP UDP 协议在传输层</li><li>严格来说，应该拿 TCP 和 UDP 进行比较</li></ul><p><img src="'+c+'" alt="image-20230115200304620"></p><p>TCP 协议</p><ul><li>有连接（三次握手）</li><li>有断开（四次挥手）</li><li>稳定传输</li></ul><p>UDP 协议</p><ul><li>无连接，无断开</li><li>不稳定传输，但效率高</li><li>如视频会议，语言通话</li></ul><p>对比</p><ul><li>HTTP 是应用层，TCP UDP 是传输层</li><li>TCP 有连接，有断开，稳定传输</li><li>UDP 无连接，无断开，不稳定传输，但效率高</li></ul><h2 id="_6-http-协议-1-0、1-1、2-0-有什么区别" tabindex="-1"><a class="header-anchor" href="#_6-http-协议-1-0、1-1、2-0-有什么区别" aria-hidden="true">#</a> 6. HTTP 协议 1.0、1.1、2.0 有什么区别？</h2><p>HTTP 1.0</p><ul><li>最基础的 HTTP 协议</li><li>支持基本的 GET POST 方法</li></ul><p>HTTP 1.2 (常用)</p><ul><li>缓存策略 cache-control E-tag 等</li><li>支持长连接 Connection: keep-alive, 一次 TCP 连接多次请求</li><li>断点续传，状态码 206</li><li>支持新的方法 PUT DELETE 等，可用于 Restful API</li></ul><p>HTTP 2.0</p><ul><li>可压缩 header, 减少体积</li><li>多路复用，一次 TCP 连接中可以多个 HTTP 并发请求</li><li>服务端推送</li></ul><h2 id="_7-什么是-https-中间人攻击-如何预防" tabindex="-1"><a class="header-anchor" href="#_7-什么是-https-中间人攻击-如何预防" aria-hidden="true">#</a> 7. 什么是 HTTPS 中间人攻击？如何预防？</h2><p>HTTPS 加密传输</p><ul><li>HTTP 明文传输，如果中间被截取，账号、密码就会被盗取</li><li>HTTPS 加密传输 HTTP + TLS/SSL (加密)</li></ul><p>中间人攻击（ 针对 HTTPS ）</p><ul><li>黑客用自己的公钥发给客户端</li><li>然后再用自己的私钥解密用户发来的数据</li></ul><p>如何预防 中间人攻击？</p><ul><li>使用正规的第三方证书</li></ul><p><img src="'+l+'" alt="image-20230115205133652"></p><h2 id="_8-script-defer-和-async-有什么区别" tabindex="-1"><a class="header-anchor" href="#_8-script-defer-和-async-有什么区别" aria-hidden="true">#</a> 8. <code>script&gt;</code> defer 和 async 有什么区别？</h2><p>defer：延迟，async：异步</p><ul><li>无：HTML 暂停解析，下载 JS，执行 JS，再继续解析 HTML</li><li>defer：HTML 继续解析，并行下载 JS, HTML 解析完再执行 JS</li><li>async：HTML 继续解析，并行下载 JS, 执行 JS, 再解析 HTML</li></ul><p><img src="'+i+`" alt="image-20230116164846163"></p><h2 id="_9-prefetch-和-dns-prefetch-有什么区别" tabindex="-1"><a class="header-anchor" href="#_9-prefetch-和-dns-prefetch-有什么区别" aria-hidden="true">#</a> 9. prefetch 和 dns-prefetch 有什么区别？</h2><p>preload 和 prefetch</p><ul><li>preload 资源在当前页面使用，会<strong>优先</strong>加载</li><li>prefetch 资源在未来页面使用，<strong>空闲</strong>时加载</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- preload --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>style.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>style<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token comment">&lt;!-- prefetch --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>other.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>dns-prefetch 和 preconnet</p><ul><li>dns-prefetch 即 DNS 预查询</li><li>preconnect 即 DNS 预连接</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>“dns-prefetch”<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.gstatic.com/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>“preconnect”<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.gstatic.com/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>prefetch 是资源预获取（和 preload 相关）</p><p>dns-prefetch 是 DNS 预查询（和 preconnect 相关）</p></blockquote><h2 id="_10-你知道哪些前端攻击-该如何预防" tabindex="-1"><a class="header-anchor" href="#_10-你知道哪些前端攻击-该如何预防" aria-hidden="true">#</a> 10. 你知道哪些前端攻击？该如何预防？</h2><p>xss</p><ul><li>Cross Site Script 跨站脚本攻击</li><li>手段：黑客将 JS 代码 插入到网页内容中，渲染时执行 JS 代码</li><li>预防：特殊字符替换（前端或者后端），如 <code>&lt;</code> <code>&gt;</code> 替换成 <code>&amp;lt</code> <code>&amp;gt</code></li><li>Vue、React 默认屏蔽了 xss 攻击</li><li>但是 Vue (v-html)、React (dangerouslySetInnerHTML) 会导致 xss 攻击，所以尽可能不要使用这两个</li></ul><p>CSRF</p><ul><li>Cross Site Request Forgery 跨站请求伪造</li><li>手段：黑客诱导用户去访问另一个网站的接口，伪造请求</li><li>预防：严格的跨域限制 + 验证码机制</li></ul><p>CSRF 详细过程</p><ul><li>用户登录了 A 网站，有了 cookie</li><li>黑客诱导用户到 B 网站，并发起 A 网站的请求</li><li>A 网站的 API 发现有 cookie, 认为是用户自己操作的</li></ul><p>SCRF 预防手段</p><ul><li>严格的跨域请求限制，如判断 referrer (请求来源)</li><li>为 cookie 设置 SameSite, 禁止跨域传递 cookie</li><li>关键接口使用短信验证码</li></ul><p>点击劫持</p><ul><li>Click Jacking</li><li>手段：诱导界面上蒙一个透明的 iframe, 诱导用户点击</li><li>预防：让 iframe 不能跨域加载 (Response headers 设置 X-Frame-Options: sameorigin)</li></ul><p>DDoS</p><ul><li>Distribute denial-of-service 分布式拒绝服务</li><li>手段：分布式的、大规模的流量访问，使服务器瘫痪</li><li>预防：软件层不好做，需硬件预防 (如阿里云 WAF)</li></ul><p>SQL 注入</p><ul><li>手段：黑客提交内容时写入 SQL 语句，破坏数据库</li><li>预防：处理输入的内容，替换特殊字符</li></ul><blockquote><p>总结：前端攻击有哪些</p><ul><li>XSS</li><li>CSRF</li><li>点击劫持</li><li>DDoS</li><li>SQL 注入</li></ul><p>关于前端、后端安全或者其他校验等，前后端都要一起做，即使做重复了，也要做</p></blockquote><h2 id="_11-websocket-和-http-协议的区别" tabindex="-1"><a class="header-anchor" href="#_11-websocket-和-http-协议的区别" aria-hidden="true">#</a> 11. WebSocket 和 HTTP 协议的区别？</h2><p>WebSocket</p><ul><li>支持端对端通讯</li><li>可以由 client 发起，也可以由 server 发起</li><li>用于：消息通知，直播间讨论区，聊天室，协同编辑</li></ul><p>WebSocket 连接过程</p><ul><li>先发起一个 HTTP 请求</li><li>成功之后再升级到 WebSocket 协议，再通讯</li></ul><p>WebSocket 和 HTTP 区别</p><ul><li>WebSocket 协议名是 ws://, 可双端发起请求</li><li>WebSocket 没有跨域限制</li><li>通过 send 和 onmessage 通讯 (HTTP 通过 req 和 res)</li></ul><p>--- 聊天室简单示例 ---</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 客户端 A</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://127.0.0.1:3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;opened&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;A opened&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;A received&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> btnSend <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn-send&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btnSend<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;A time is&quot;</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 客户端 B</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://127.0.0.1:3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;opened&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;B opened&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;B received&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> btnSend <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn-send&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btnSend<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;B time is&quot;</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 服务端</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> WebSocketServer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ws&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> wsServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

wsServer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">curWs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;connected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 这里，不能一直被 add, 实际使用中，这里应该有一些清理缓存的机制，长期用不到的 ws 要被清除</span>
  list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>curWs<span class="token punctuation">)</span><span class="token punctuation">;</span>

  curWs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;received message&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 传递给其他客户端</span>
    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ws</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ws <span class="token operator">===</span> curWs<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ws 可升级为 wss (像 https)</p><p>扩展：实际项目推荐 socket.io, API 更简洁</p></blockquote><h2 id="_12-websocket-和-http-长轮询的区别" tabindex="-1"><a class="header-anchor" href="#_12-websocket-和-http-长轮询的区别" aria-hidden="true">#</a> 12. WebSocket 和 HTTP 长轮询的区别？</h2><p>区别</p><ul><li>HTTP 长轮询：客户端发起请求，服务端阻塞，不会立即返回</li><li>WebSocket：客户端可发起请求，服务端也可发起请求</li></ul><blockquote><p>注意：HTTP 长轮询，需处理 timeout, 即 timeout 之后重新发请求</p></blockquote><h2 id="_13-描述从输入-url-到页面展示的完整过程" tabindex="-1"><a class="header-anchor" href="#_13-描述从输入-url-到页面展示的完整过程" aria-hidden="true">#</a> 13. 描述从输入 url 到页面展示的完整过程</h2><p>步骤</p><ul><li>网络请求</li><li>解析</li><li>渲染</li></ul><p>网络请求</p><ul><li>DNS 查询 (得到 IP), 建立 TCP 连接 (三次握手)</li><li>浏览器发起 HTTP 请求</li><li>收到请求响应，得到 HTML 源代码</li></ul><p>继续请求静态资源</p><ul><li>解析 HTML 过程中，遇到静态资源还会继续发起网络请求</li><li>JS CSS 图片 视频等</li><li>注意：静态资源可能有强缓存，此时不必请求</li></ul><p>解析：字符串 -&gt; 结构化数据</p><ul><li>HTML 构建 DOM 树</li><li>CSS 构建 CSSOM 树 (style tree)</li><li>两者结合，形成渲染树 (render tree)</li></ul><blockquote><p>优化解析</p><ul><li>CSS 放在 <code>&lt;head&gt;</code> 中，不要异步加载 CSS</li><li>JS 放在 <code>&lt;body&gt;</code> 最下面 (或合理使用 defer async)</li><li><code>&lt;img&gt;</code> 提前定义 width height</li></ul></blockquote><p>渲染：Render Tree 绘制到页面</p><ul><li>计算各个 DOM 的尺寸、定位, 最后绘制到页面</li><li>遇到 JS 可能会执行 (参考 defer async)</li><li>异步 CSS、图片加载, 可能会触发重新渲染</li></ul><p>整个完整解析过程</p><p><img src="`+u+`" alt="image-20230116223029019"></p><blockquote><p>总结</p><ul><li>网络请求：DNS 解析，HTTP 请求</li><li>解析：DOM 树，CSSOM 树，Render Tree</li><li>渲染：计算、绘制，同时执行 JS</li></ul></blockquote><h2 id="_14-重绘-repaint-重排-reflow-有什么区别" tabindex="-1"><a class="header-anchor" href="#_14-重绘-repaint-重排-reflow-有什么区别" aria-hidden="true">#</a> 14. 重绘 repaint 重排 reflow 有什么区别？</h2><p>动态网页，随时都会重绘、重排</p><ul><li>网页动画</li><li>Modal Dialog 弹窗</li><li>增加/删除一个元素，显示/隐藏一个元素</li></ul><p>重绘 repaint</p><ul><li>元素外观改变，如颜色、背景色</li><li>但元素的尺寸、定位不变，不会影响其他元素的位置</li></ul><p>重排 reflow</p><ul><li>重新计算尺寸和布局，可能会影响其他元素的位置</li><li>如元素高度增加，可能会使相邻元素位置下移</li></ul><p>区别</p><ul><li>重排比重绘要影响更大，消耗也更大</li><li>所以，要尽量避免无意义的重排</li></ul><p>减少重排的方法</p><ul><li>集中修改样式，或直接切换 css class</li><li>修改之前先设置 display: none, 脱离文档流</li><li>使用 BFC 特性，不影响其他元素位置（ BFC 内部不影响外部 ）</li><li>频繁触发 (resize scroll) 使用节流和防抖</li><li>使用 createDocumentFragment 批量操作 DOM</li><li>优化动画，使用 CSS3 和 requestAnimationFrame</li></ul><blockquote><p>注意：CSS3 动画 比 JS 动画更快，是因为 CSS3 触发了 GPU 加速</p><p>扩展：BFC</p><ul><li>Block Format Context 块级格式化上下文</li><li>内部的元素无论如何改变，都不会影响其他元素的位置</li></ul><p>触发 BFC 的条件</p><ul><li>根节点 <code>html&gt;</code></li><li>float: left/right</li><li>overflow: auto/scroll/hidden</li><li>display: inline-block/table/table-row/table-cell</li><li>display:flex/grid 的直接子元素</li><li>position: absolute/fixed</li></ul></blockquote><h2 id="_15-如何实现网页多标签通讯" tabindex="-1"><a class="header-anchor" href="#_15-如何实现网页多标签通讯" aria-hidden="true">#</a> 15. 如何实现网页多标签通讯？</h2><p>使用 WebSocket</p><ul><li>无跨域限制</li><li>需要服务端支持，成本高</li></ul><p>通过 localStorage 通讯</p><ul><li>同域的 A 和 B 两个页面</li><li>A 页面设置 localStorage</li><li>B 页面可监听到 localStorage 值的修改</li></ul><p>-- localStorage 实现多标签 通讯 代码实现 --</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// A 页面</span>
<span class="token keyword">const</span> btn1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;标题&quot;</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;changeInfo&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// localStorage、cookie 跨域不共享</span>

<span class="token comment">// B 页面</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;storage&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过 SharedWorker 通讯</p><ul><li>SharedWorker 是 WebWorker 的一种</li><li>WebWorker 可开启子<strong>进程</strong>执行 JS, 但不能操作 DOM</li><li>SharedWorker 可单独开启一个进程, 用于<strong>同域</strong>页面通讯</li></ul><p>-- SharedWorker 实现多标签 通讯 代码实现 --</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// worker.js</span>
<span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function-variable function">onconnect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> event<span class="token punctuation">.</span>ports<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 接收信息</span>
  port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 广播消息</span>
    set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">===</span> port<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 如果是自己就不广播，port 就是自己</span>
      p<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 发送信息</span>
  port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// A 页面</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&quot;./worker.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> btn1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;detail go...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// B 页面</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token string">&quot;./worker.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>总结</p><ul><li>WebSocket 需要服务端，成本较高</li><li>localStorage 简单易用，推荐 (同域)</li><li>SharedWorker 调试不方便, 不兼容 IE11</li></ul></blockquote><h2 id="_16-网页-和-iframe-如何通讯" tabindex="-1"><a class="header-anchor" href="#_16-网页-和-iframe-如何通讯" aria-hidden="true">#</a> 16. 网页 和 iframe 如何通讯？</h2><p>重点</p><ul><li>使用 postMessage 通讯</li><li>注意跨域的限制和判断</li></ul><p>-- 代码演示 --</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code>// 页面
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    index page
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iframe1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./child.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> btn1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      window<span class="token punctuation">.</span>iframe1<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第二个参数是个域名</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 来源的域名</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;index received&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
// iframe
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    child page
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送消息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> btn1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    btn1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;child clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      window<span class="token punctuation">.</span>parent <span class="token operator">/</span> <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 判断 origin 的合法性</span>
      console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;child received&quot;</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_17-请描述-koa2-的洋葱圈模型" tabindex="-1"><a class="header-anchor" href="#_17-请描述-koa2-的洋葱圈模型" aria-hidden="true">#</a> 17. 请描述 Koa2 的洋葱圈模型</h2><p>Koa2</p><ul><li>一个简约、流行的 nodejs 框架</li><li>通过中间件组织代码</li><li>多个中间件以 ”洋葱圈模型“ 执行</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 洋葱圈模型 代码演示</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// logger</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先执行下一步 x-response-time, 执行完再继续执行</span>
  <span class="token keyword">const</span> ms <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ctx<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ctx<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ms<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// x-response-time</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先执行下一步 response, 执行完再继续执行</span>
  <span class="token keyword">const</span> ms <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-Response-Time&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ms<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// response</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>洋葱圈模型</p><p><img src="`+k+'" alt="image-20230117004631255"></p>',162),v=[d];function m(g,b){return s(),a("div",null,v)}const f=n(r,[["render",m],["__file","知识广度-从前端到全栈.html.vue"]]);export{f as default};
